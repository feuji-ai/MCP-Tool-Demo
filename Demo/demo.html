<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP Conductor - Real Integration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #2d3748;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            color: #2b6cb0;
            margin-bottom: 10px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .status {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .status.ready { color: #48bb78; }
        .status.busy { color: #ed8936; }
        .status.error { color: #f56565; }

        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .chat-section, .sidebar {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .section-header {
            background: #edf2f7;
            padding: 15px 20px;
            border-bottom: 1px solid #e2e8f0;
            font-weight: 600;
            color: #4a5568;
        }

        .chat-container {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
        }

        .message {
            margin-bottom: 15px;
            max-width: 80%;
        }

        .message.user {
            margin-left: auto;
        }

        .message-content {
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
        }

        .message.user .message-content {
            background: #3182ce;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.assistant .message-content {
            background: #f7fafc;
            color: #2d3748;
            border: 1px solid #e2e8f0;
            border-bottom-left-radius: 4px;
        }

        .message-label {
            font-size: 12px;
            color: #718096;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .chat-input {
            padding: 20px;
            border-top: 1px solid #e2e8f0;
            background: #f7fafc;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
        }

        .chat-input input:focus {
            border-color: #3182ce;
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn.primary {
            background: #3182ce;
            color: white;
        }

        .btn.primary:hover {
            background: #2c5282;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .controls {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #4a5568;
        }

        .control-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        .logs {
            background: #1a202c;
            color: #e2e8f0;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 12px;
            line-height: 1.4;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
        }

        .log-entry {
            margin-bottom: 4px;
        }

        .log-success { color: #68d391; }
        .log-warning { color: #fbb040; }
        .log-error { color: #fc8181; }
        .log-stealth { color: #d391e8; }

        .server-item {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .server-item:last-child {
            border-bottom: none;
        }

        .server-info {
            flex: 1;
        }

        .server-name {
            font-weight: 500;
            color: #2d3748;
            margin-bottom: 4px;
        }

        .server-description {
            font-size: 12px;
            color: #718096;
            margin-bottom: 8px;
        }

        .server-command {
            font-size: 11px;
            color: #a0aec0;
            font-family: monospace;
        }

        .server-toggle {
            margin-left: 10px;
        }

        .checkbox {
            margin-right: 8px;
        }

        .hidden {
            display: none;
        }

        .server-count {
            background: #e2e8f0;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }

        .quick-actions {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .quick-actions h4 {
            margin-bottom: 10px;
            color: #4a5568;
            font-size: 14px;
        }

        .quick-btn {
            display: block;
            width: 100%;
            padding: 8px 12px;
            margin-bottom: 8px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            text-align: left;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .quick-btn:hover {
            background: #f0f7ff;
            border-color: #3182ce;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid #3182ce;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>⚡ MCP Conductor</h1>
            <small style="color: #718096;">Real MCP Integration with Password Manager & Stealth Mode</small>
        </div>

        <div class="status-bar">
            <div class="status error" id="agentStatus">
                <span id="statusIcon">🔴</span>
                <span id="statusText">Not Ready</span>
            </div>
            <div>
                <span id="serverCount">0 servers</span> •
                <span id="messageCount">0 messages</span>
            </div>
        </div>

        <div class="main-grid">
            <div class="chat-section">
                <div class="section-header">💬 Chat</div>

                <div class="controls">
                    <div class="control-group">
                        <label>Working Directory</label>
                        <input type="text" id="workingDir" value="/Users/ramacharanreddykasireddy/ReQon/MCP-Tool-Demo">
                    </div>

                    <div class="button-group">
                        <button class="btn primary" id="startBtn" onclick="startAgent()">🚀 Start Agent</button>
                        <button class="btn" id="resetBtn" onclick="resetAgent()">🔄 Reset</button>
                        <button class="btn" onclick="clearChat()">🧹 Clear</button>
                    </div>
                </div>

                <div class="chat-container" id="chatContainer">
                    <div style="text-align: center; color: #a0aec0; padding: 50px;">
                        Start a conversation with your AI agent<br>
                        <small>Real MCP Conductor with filesystem, browser automation & password management</small><br>
                        <small style="color: #9c27b0;">🥷 STEALTH mode: Execution details in logs only</small>
                    </div>
                </div>

                <div class="chat-input">
                    <div class="input-group">
                        <input type="text" id="messageInput" placeholder="Type your message here..." onkeypress="handleKeyPress(event)">
                        <button class="btn primary" onclick="sendMessage()" id="sendBtn" disabled>Send</button>
                    </div>
                </div>

                <div class="section-header">📋 Execution Logs (Including Stealth Details)</div>
                <div class="logs" id="logs">
                    <div style="color: #a0aec0;">Waiting for activity...</div>
                </div>
            </div>

            <div class="sidebar">
                <div class="section-header">
                    🖥️ Server Management
                    <span class="server-count" id="serverCountBadge">0 servers</span>
                </div>

                <div id="serverList">
                    <div class="empty-servers">
                        <div style="color: #a0aec0;">Loading servers...</div>
                    </div>
                </div>

                <div style="padding: 15px; border-top: 1px solid #e2e8f0;">
                    <button class="btn" onclick="addPlaywright()" style="width: 100%; margin-bottom: 10px;">🎭 Add Playwright</button>
                    <button class="btn" onclick="addPasswordManager()" style="width: 100%; margin-bottom: 10px;">🔐 Add Password Manager</button>
                    <button class="btn" onclick="checkInstructions()" style="width: 100%;">📋 Check Instructions</button>
                </div>

                <div class="quick-actions">
                    <h4>🚀 Quick Demo Commands</h4>
                    <button class="quick-btn" onclick="sendQuickMessage('Generate a 16-character password with symbols')">
                        🔑 Generate Password
                    </button>
                    <button class="quick-btn" onclick="sendQuickMessage('Save a password for GitHub with username myuser and password SecurePass123!')">
                        💾 Save Password
                    </button>
                    <button class="quick-btn" onclick="sendQuickMessage('List all my saved passwords')">
                        📋 List Passwords
                    </button>
                    <button class="quick-btn" onclick="sendQuickMessage('Navigate to https://saucedemo.com and login with standard_user')">
                        🌐 Web Automation
                    </button>
                    <button class="quick-btn" onclick="sendQuickMessage('Read Test/Example/instructions.txt and execute the task')">
                        📖 Read & Execute
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let ws = null;
        let agentReady = false;
        let executing = false;
        let chatHistory = [];
        let servers = [];
        let currentStealthSession = null;

        // Initialize WebSocket connection
        function initWebSocket() {
            ws = new WebSocket('ws://localhost:8765');

            ws.onopen = function() {
                addLog('🔗 Connected to real MCP backend', 'info');
                ws.send(JSON.stringify({type: 'get_server_list'}));
            };

            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                handleMessage(data);
            };

            ws.onclose = function() {
                addLog('⌐ Disconnected from backend', 'error');
                updateStatus('error', '🔴', 'Disconnected');
                agentReady = false;
                updateSendButton();
            };

            ws.onerror = function(error) {
                addLog('⌐ WebSocket error', 'error');
            };
        }

        function handleMessage(data) {
            switch(data.type) {
                case 'log':
                    addLog(data.message, data.level);
                    break;
                case 'status':
                    updateStatus(data.status, data.icon, data.text);
                    agentReady = data.status === 'ready';
                    updateSendButton();
                    break;
                case 'chat_response':
                    addChatMessage('assistant', data.message);
                    if (currentStealthSession) {
                        addLog(`🥷 STEALTH MISSION COMPLETE`, 'stealth');
                        currentStealthSession = null;
                    }
                    executing = false;
                    updateSendButton();
                    break;
                case 'execution_step':
                    addLog(`🔧 ${data.step}: ${data.tool}`, 'info');
                    break;
                case 'agent_ready':
                    agentReady = true;
                    updateStatus('ready', '🟢', 'Ready');
                    document.getElementById('startBtn').disabled = false;
                    updateSendButton();
                    break;
                case 'server_list_update':
                    updateServerList(data.servers, data.total_count, data.enabled_count);
                    break;
                case 'stealth_header':
                    handleStealthHeader(data.query, data.thread_id);
                    break;
                case 'stealth_step':
                    handleStealthStep(data);
                    break;
                case 'stealth_result':
                    handleStealthResult(data);
                    break;
                case 'stealth_reasoning':
                    handleStealthReasoning(data.content);
                    break;
                case 'stealth_complete':
                    handleStealthComplete(data);
                    break;
                case 'error':
                    addLog(`⌐ ${data.message}`, 'error');
                    executing = false;
                    updateSendButton();
                    break;
            }
        }

        function handleStealthHeader(query, threadId) {
            currentStealthSession = {
                threadId: threadId,
                startTime: Date.now(),
                stepCount: 0
            };
            addLog(`🥷 STEALTH EXECUTION STARTED`, 'stealth');
            addLog(`🧵 Thread: ${threadId.substring(0, 8)}...`, 'stealth');
            addLog(`🔒 Query: [HIDDEN FOR PRIVACY]`, 'stealth');
        }

        function handleStealthStep(data) {
            if (currentStealthSession) {
                currentStealthSession.stepCount++;
            }
            addLog(`🥷 Step ${data.step_number} - STEALTH TOOL EXECUTION #${data.execution_number}`, 'stealth');
            addLog(`🛠️ Tool: ${data.tool_name}`, 'stealth');
            addLog(`📥 Input: ${data.tool_input.substring(0, 100)}${data.tool_input.length > 100 ? '...' : ''}`, 'stealth');
        }

        function handleStealthResult(data) {
            addLog(`✅ Output: ${data.content_preview}`, 'stealth');
            addLog(`📊 Length: ${data.content_length} characters`, 'stealth');
        }

        function handleStealthReasoning(content) {
            addLog(`🤖 STEALTH AI REASONING: ${content}`, 'stealth');
        }

        function handleStealthComplete(data) {
            if (currentStealthSession) {
                const duration = ((Date.now() - currentStealthSession.startTime) / 1000).toFixed(1);
                addLog(`🥷 STEALTH EXECUTION STATISTICS:`, 'stealth');
                addLog(`⏱️ Total Time: ${duration} seconds`, 'stealth');
                addLog(`🔧 Tool Executions: ${data.tool_executions}`, 'stealth');
                addLog(`📝 Total Steps: ${data.total_steps}`, 'stealth');
                addLog(`🥷 Status: ${data.success ? 'Mission Success' : 'Mission Failed'}`, 'stealth');
            }
        }

        function updateServerList(serverList, totalCount, enabledCount) {
            servers = serverList;
            const container = document.getElementById('serverList');

            if (serverList.length === 0) {
                container.innerHTML = `
                    <div class="empty-servers">
                        <div style="color: #a0aec0;">No servers configured</div>
                    </div>
                `;
            } else {
                container.innerHTML = '';

                serverList.forEach(server => {
                    const serverDiv = document.createElement('div');
                    serverDiv.className = 'server-item';

                    serverDiv.innerHTML = `
                        <div class="server-info">
                            <div class="server-name">
                                <input type="checkbox" class="checkbox"
                                       ${server.enabled ? 'checked' : ''}
                                       onchange="toggleServer('${server.name}', this.checked)">
                                ${server.name}
                            </div>
                            <div class="server-description">${server.description}</div>
                            <div class="server-command">${server.command}</div>
                        </div>
                    `;

                    container.appendChild(serverDiv);
                });
            }

            document.getElementById('serverCount').textContent = `${totalCount} servers`;
            document.getElementById('serverCountBadge').textContent = `${enabledCount}/${totalCount} enabled`;
        }

        function startAgent() {
            const workingDir = document.getElementById('workingDir').value;
            document.getElementById('startBtn').disabled = true;

            ws.send(JSON.stringify({
                type: 'start_agent',
                working_dir: workingDir
            }));
        }

        function resetAgent() {
            agentReady = false;
            executing = false;
            currentStealthSession = null;
            updateStatus('error', '🔴', 'Not Ready');
            document.getElementById('startBtn').disabled = false;
            updateSendButton();

            ws.send(JSON.stringify({
                type: 'reset_agent'
            }));
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();

            if (!message || !agentReady || executing) return;

            addChatMessage('user', message);
            input.value = '';
            executing = true;
            updateSendButton();

            ws.send(JSON.stringify({
                type: 'execute_query',
                message: message
            }));
        }

        function sendQuickMessage(message) {
            if (!agentReady || executing) return;

            document.getElementById('messageInput').value = message;
            sendMessage();
        }

        function addChatMessage(role, content) {
            chatHistory.push({role, content});

            const container = document.getElementById('chatContainer');

            if (chatHistory.length === 1) {
                container.innerHTML = '';
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;

            messageDiv.innerHTML = `
                <div class="message-label">${role === 'user' ? 'You' : 'Assistant'}</div>
                <div class="message-content">${content}</div>
            `;

            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;

            updateMessageCount();
        }

        function addLog(message, level = 'info') {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();

            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${level}`;

            const emoji = {
                'info': 'ℹ️',
                'success': '✅',
                'warning': '⚠️',
                'error': '⌐',
                'stealth': '🥷'
            }[level] || '📝';

            logEntry.textContent = `${timestamp} ${emoji} ${message}`;
            logs.appendChild(logEntry);

            while (logs.children.length > 100) {
                logs.removeChild(logs.firstChild);
            }

            logs.scrollTop = logs.scrollHeight;
        }

        function updateStatus(status, icon, text) {
            const statusElement = document.getElementById('agentStatus');
            statusElement.className = `status ${status}`;
            document.getElementById('statusIcon').textContent = icon;
            document.getElementById('statusText').textContent = text;
        }

        function updateSendButton() {
            const sendBtn = document.getElementById('sendBtn');
            const canSend = agentReady && !executing;
            sendBtn.disabled = !canSend;

            if (executing) {
                sendBtn.textContent = '⏳ Processing...';
            } else if (agentReady) {
                sendBtn.textContent = 'Send';
            } else {
                sendBtn.textContent = 'Agent Not Ready';
            }
        }

        function updateMessageCount() {
            document.getElementById('messageCount').textContent = `${chatHistory.length} messages`;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function clearChat() {
            chatHistory = [];
            currentStealthSession = null;
            document.getElementById('chatContainer').innerHTML = `
                <div style="text-align: center; color: #a0aec0; padding: 50px;">
                    Start a conversation with your AI agent<br>
                    <small>Real MCP Conductor with filesystem, browser automation & password management</small><br>
                    <small style="color: #9c27b0;">🥷 STEALTH mode: Execution details in logs only</small>
                </div>
            `;
            updateMessageCount();
        }

        function toggleServer(name, enabled) {
            ws.send(JSON.stringify({
                type: 'toggle_server',
                name: name,
                enabled: enabled
            }));
        }

        function addPlaywright() {
            ws.send(JSON.stringify({
                type: 'add_server',
                name: 'playwright',
                command: 'npx',
                args: ['@playwright/mcp@latest'],
                description: 'Browser automation and web scraping'
            }));
        }

        function addPasswordManager() {
            ws.send(JSON.stringify({
                type: 'add_server',
                name: 'password_manager',
                command: 'python',
                args: ['Custom/password_server.py'],
                description: 'Password management - generate, save, encrypt/decrypt passwords securely'
            }));
        }

        function checkInstructions() {
            ws.send(JSON.stringify({
                type: 'check_instructions'
            }));
        }

        window.onload = function() {
            initWebSocket();
            updateSendButton();
        };
    </script>
</body>
</html>